<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>easypay-配置管理</title>
	<meta name="renderer" content="webkit">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<meta name="apple-mobile-web-app-status-bar-style" content="black">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="format-detection" content="telephone=no">
	<link rel="stylesheet" href="../libs/layui/css/layui.css" media="all" />
	<link rel="stylesheet" href="../css/public.css" media="all" />
	<script type="text/javascript" src="../libs/layui/layui.js"></script>
	<script type="text/javascript" src="../js/jquery-3.5.1.min.js"></script>
</head>
<body class="childrenBody">
<table class="layui-table" id="pay_config_table">
</table>
<div id="dataForm" class="layui-hide">
	<form class="layui-form" action="xxx">
	    <div class="layui-form-item">
		   <label class="layui-form-label">code：</label>
		    <div class="layui-input-inline layui-input-wrap">
			    <input type="text" id="data-code" name="vercode" lay-verify="required" disabled autocomplete="off" lay-affix="clear" class="layui-input">
		    </div>
	    </div>
	    <div class="layui-form-item">
	    	<label class="layui-form-label">状态：</label>
	    	<div class="layui-input-block">
		    	<input type="radio" name="data-status" value="0" title="关闭" checked>
		    	<input type="radio" name="data-status" value="1" title="开启">
		    </div>
	    </div>
		<div class="layui-form-item">
			<label class="layui-form-label">算法类型：</label>
			<div class="layui-input-block">
				<input type="radio" name="data-algorithm" value="1" title="RSA2" checked>
			</div>
		</div>
		<div class="layui-form-item">
			<label class="layui-form-label">网关类型：</label>
			<div class="layui-input-block">
				<input type="radio" name="data-gateway" value="1" title="线上">
				<input type="radio" name="data-gateway" value="2" title="沙箱" checked>
			</div>
		</div>
		<div class="layui-form-item layui-form-text">
			<label class="layui-form-label">商户私钥：</label>
			<div class="layui-input-block">
				<textarea placeholder="请输入内容" class="layui-textarea"></textarea>
			</div>
		</div>
		<div class="layui-form-item layui-form-text">
			<label class="layui-form-label">支付宝公钥：</label>
			<div class="layui-input-block">
				<textarea placeholder="请输入内容" class="layui-textarea"></textarea>
			</div>
		</div>
	    <div class="layui-form-item">
		    <label class="layui-form-label">备注：</label>
		    <div class="layui-input-inline layui-input-wrap">
		    	<input type="text" name="vercode" id="data-remark" lay-verify="required" autocomplete="off" lay-affix="clear" class="layui-input">
		    </div>
	    </div>
		<div class="layui-form-item">
			<div class="layui-input-block">
				<button type="submit" class="layui-btn" lay-submit lay-filter="demo1">立即提交</button>
				<button type="reset" class="layui-btn layui-btn-primary">重置</button>
			</div>
		</div>
	</form>
</div>

<script>
	layui.use(['table'], function () {
		var table = layui.table;
		table.render({
			elem: '#pay_config_table',
			url: 'http://localhost:8081/payApp/list', // 后端接口地址
			method: 'GET', // 请求方式
			parseData: function (res) { // 数据格式解析函数
				return {
					code: res.code,
					count: res.data.total,
					data: res.data.list
				};
			},
			page: true,
			limits: [10, 15, 20, 25],
			limit: 13,
			request: {
				pageName: 'pageNo', // 页码的参数名称，默认：page
				limitName: 'pageSize' // 每页数据条数的参数名，默认：limit
			},
			cols: [[
				{field: 'id', title: '应用编号', rowspan: 2},
				{field: 'name', title: '应用昵称', rowspan: 2},
				{field: 'status', title: '是否开启', rowspan: 2},
				{field: 'notifyUrl', title: '支付回调地址', rowspan: 2},
				{field: 'notifyRefundUrl', title: '退款回调地址', rowspan: 2},
				{align: 'center', colspan: 3, title: '支付宝'},
				{align: 'center', colspan: 3, title: '微信'},
				{
					fixed: 'right', align: 'center', title: '操作', rowspan: 2, templet: function (d) {
						return '<button type="button" data-id="123" class="layui-btn layui-btn-xs layui-btn-normal">编辑</button>';
					}
				}
			], [
				{
					field: 'alipayPC', align: 'center', title: 'PC支付', templet: function (d) {
						if (d.configCodes && d.configCodes.includes("alipay_pc")) {
							return '<button id="alipay_pc" data-id="'+d.id+'" type="button" class="layui-btn layui-btn-xs" lay-on="page">查看</button>\n';
						} else {
							return '<button type="button" class="layui-btn layui-btn-xs layui-btn-danger">未设置</button>';
						}
					}
				},
				{
					field: 'alipayFaceToFace', align: 'center', title: 'APP支付', templet: function (d) {
						if (d.configCodes && d.configCodes.includes("alipay_app")) {
							return '<button id="alipay_app" type="button" data-id="'+d.id+'" class="layui-btn layui-btn-xs" lay-on="page">查看</button>'
						} else {
							return '<button type="button" class="layui-btn layui-btn-xs layui-btn-danger">未设置</button>';
						}
					}
				},
				{
					field: 'alipayMobile', align: 'center', title: 'WAP支付', templet: function (d) {
						if (d.configCodes && d.configCodes.includes("alipay_wap")) {
							return '<button type="button" class="layui-btn layui-btn-xs">查看</button>';
						} else {
							return '<button type="button" class="layui-btn layui-btn-xs layui-btn-danger">未设置</button>';
						}
					}
				},
				{
					field: 'wechatPC', align: 'center', title: 'PC支付', templet: function (d) {
						if (d.configCodes && d.configCodes.includes("wx_pc")) {
							return '<button type="button" class="layui-btn layui-btn-xs">查看</button>';
						} else {
							return '<button type="button" class="layui-btn layui-btn-xs layui-btn-danger">未设置</button>';
						}
					}
				},
				{
					field: 'wechatFaceToFace', align: 'center', title: '面对面', templet: function (d) {
						if (d.configCodes && d.configCodes.includes("wx_qr")) {
							return '<button type="button" class="layui-btn layui-btn-xs">查看</button>';
						} else {
							return '<button type="button" class="layui-btn layui-btn-xs layui-btn-danger">未设置</button>';
						}
					}
				},
				{
					field: 'wechatMobile', align: 'center', title: 'WAP支付', templet: function (d) {
						if (d.configCodes && d.configCodes.includes("wx_wap")) {
							return '<button type="button" class="layui-btn layui-btn-xs">查看</button>';
						} else {
							return '<button type="button" class="layui-btn layui-btn-xs layui-btn-danger">未设置</button>';
						}
					}
				}
			]]
		});

		var layer = layui.layer;
		var util = layui.util;
		var render='';
		// 批量事件
		util.on('lay-on', {
			page: function(){
				$('#dataForm').removeClass("layui-hide")
				//通过id向后端传递数据
				var appId = $(this).data('id');
				var code = this.id;
				let url = "/config/get?code="+ code + "&payAppId=" + appId;
				$.get(url,function (data){

					//数据渲染到html
					$('#data-code').val(data.data.code)
					$('#data-remark').val(data.data.remark)
					$('input[name="data-status"][value="'+ data.data.status + '"]').prop('checked', true);
					layui.form.render();

				});
				// 页面层
				layer.open({
					type: 1,
					area: ['520px', 'auto'],
					content: $('#dataForm'),
					fixed:true,
					end: function(){
						$('#dataForm').addClass("layui-hide")
					}
				});
			},
		})
	})
</script>
</body>
</html>
